<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Producto â€¢ Adelie Glam</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- HEADER -->
  <header class="topbar">
    <a href="index.html" class="brand">
      <svg class="mini-logo" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M10 2a1 1 0 00-.894.553L7.382 6H3a1 1 0 00-.832 1.554l3 5A1 1 0 006 12h8a1 1 0 00.832-1.554l-3-5A1 1 0 0013 6h-4.382l-1.724-3.447A1 1 0 0010 2z"/>
        <path d="M3 14a1 1 0 100 2h14a1 1 0 100-2H3z"/>
      </svg>
      <span class="logo-text">Adelie</span>
    </a>

    <div class="socials">
    <a href="mailto:adeliee.glam@gmail.com?subject=Consulta%20Adelie%20Glam"
    aria-label="Email" title="Email">
    <svg viewBox="0 0 24 24" width="20" height="20">
        <path d="M4 6h16v12H4z" fill="none" stroke="currentColor" stroke-width="1.8"/>
        <path d="M4 7l8 6 8-6" fill="none" stroke="currentColor" stroke-width="1.8"/>
    </svg>
    </a>

  <a href="https://instagram.com/adelie.glam" target="_blank" rel="noopener" aria-label="Instagram" title="Instagram">
    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="5" ry="5" fill="none" stroke="currentColor" stroke-width="1.8"/><circle cx="12" cy="12" r="3.2" fill="none" stroke="currentColor" stroke-width="1.8"/><circle cx="17.3" cy="6.7" r="1.2"/></svg>
  </a>
</div>

  </header>

  <!-- NAV -->
  <nav class="mainnav">
    <ul>
      <li><a href="index.html">INICIO</a></li>
      <li><a class="active" href="tienda.html">TIENDA</a></li>
    </ul>
  </nav>

  <!-- CART BUTTON -->
  <a id="cart-btn" class="cart-fab" aria-label="Carrito">
    ðŸ›’ <span id="cart-count">0</span>
  </a>

  <!-- CART DRAWER -->
    <aside id="cart-drawer" class="cart-drawer" aria-hidden="true">
    <div class="cart-head">
        <strong>Tu carrito</strong>
        <button id="cart-close" aria-label="Cerrar">Ã—</button>
    </div>

    <div id="cart-items" class="cart-items"></div>

    <!-- Customer details (NEW) -->
    <div style="padding:12px 1rem; border-top:1px solid #f0cdd7;">
    <div style="display:grid; gap:.5rem;">
        <input id="cust-name"  type="text" placeholder="Tu nombre"   style="padding:.55rem .7rem;border:1px solid #e4c8d2;border-radius:8px;">
        <input id="cust-phone" type="tel"  placeholder="Tu telÃ©fono" style="padding:.55rem .7rem;border:1px solid #e4c8d2;border-radius:8px;">
        <input id="cust-email" type="email" placeholder="Tu email"    style="padding:.55rem .7rem;border:1px solid #e4c8d2;border-radius:8px;">
    </div>
    </div>


    <div class="cart-foot">
        <div class="cart-total">Total: <span id="cart-total">$0</span></div>
        <div class="cart-actions">
        <button id="cart-clear" class="btn-mini">Vaciar</button>
        <a id="cart-email" class="btn-mini" href="#" >Checkout por Email</a>
        <a id="cart-checkout" class="btn-mini" target="_blank" rel="noopener">Checkout por WhatsApp</a>
        </div>
    </div>
    </aside>


  <!-- PAGE CONTENT -->
  <main class="grid" id="product-details" style="max-width:1000px;margin:1rem auto;padding:0 1rem"></main>

  <footer class="footer">Â© 2025 Adelie Glam â€” Hecho con â™¥ en Buenos Aires</footer>

  <!-- Load cart FIRST so AdelieCart exists -->
  <script defer src="cart.js?v=13"></script>
  <script defer src="whatsapp.js?v=2"></script>

  <!-- Inline page script -->
  <script>
    (async () => {
      try {
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRGncMkuJIgCWEwgnBNOA3jCdCt4uz3ENDfW1dpC8Jmj_kbfompeOHyipVojo1tnV56WXCnER-Smopf/pub?output=csv";
        const PLACEHOLDER_IMG = "img/products/placeholder.jpg";
        const PHONE = "5491159498241";
        const addBtnHTML = `<a href="#" id="add-one" class="btn-mini">Agregar al carrito</a>`;

        const log = (...a) => console.log("[product]", ...a);

        function slugify(str = '') {
          return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '')
            .replace(/Ã±/gi, 'n').toLowerCase()
            .replace(/[^a-z0-9]+/g, '-').replace(/(^-+|-+$)/g, '');
        }
        function parseCSV(text) {
          const rows = []; let row = [], cell = '', inQuotes = false;
          for (let i = 0; i < text.length; i++) {
            const c = text[i], n = text[i + 1];
            if (c === '"' && inQuotes && n === '"') { cell += '"'; i++; continue; }
            if (c === '"') { inQuotes = !inQuotes; continue; }
            if (c === ',' && !inQuotes) { row.push(cell); cell = ''; continue; }
            if ((c === '\n' || c === '\r') && !inQuotes) {
              if (cell.length || row.length) { row.push(cell); rows.push(row); row = []; cell = ''; }
              continue;
            }
            cell += c;
          }
          if (cell.length || row.length) { row.push(cell); rows.push(row); }
          return rows;
        }
        function toObjects(rows) {
          if (!rows.length) return [];
          const header = rows[0].map(h => h.trim());
          return rows.slice(1)
            .filter(r => r.some(v => (v ?? '').toString().trim().length))
            .map(r => Object.fromEntries(header.map((h,i)=>[h,(r[i] ?? '').toString().trim()])));
        }
        function toNumberAR(v) {
          const s = (v ?? '').toString().replace(/[^\d.,-]/g,'').replace(',', '.');
          const n = Number(s); return Number.isFinite(n) ? n : 0;
        }
        function formatARS(n) { return n.toLocaleString('es-AR', { maximumFractionDigits: 0 }); }

        async function loadAll() {
          const res = await fetch(CSV_URL + "&cb=" + Date.now(), { cache: "no-store" });
          const text = await res.text();
          const rows = parseCSV(text);
          const objs = toObjects(rows);
          return objs.map(p => ({
            name: p.Producto || p.name || '',
            price: toNumberAR(p.Precio_Venta || p.price),
            stock: parseInt(p.Cantidad || p.stock || '0', 10) || 0,
            img: p.img || p.ImageURL || PLACEHOLDER_IMG,
            category: (p.category || p.categoria || '').toLowerCase(),
            tags: p.tags || '',
            desc: p.Descripcion || p.description || '',
            slug: slugify(p.Producto || p.name || '')
          }));
        }

        const params = new URLSearchParams(location.search);
        const wanted = (params.get('slug') || '').toLowerCase();
        log("slug param:", wanted);

        const all = await loadAll();
        log("loaded items:", all.length);

        const p = all.find(x => x.slug === wanted);
        log("matched product:", p);

        const box = document.getElementById('product-details');

        if (!wanted) {
          box.innerHTML = `<p style="grid-column:1/-1;text-align:center;color:#b54a64">Falta el parÃ¡metro ?slug=â€¦ en la URL.</p>`;
          return;
        }
        if (!p) {
          box.innerHTML = `<p style="grid-column:1/-1;text-align:center">Producto no encontrado. <a href="tienda.html">Volver a Tienda</a></p>`;
          return;
        }

        document.title = `${p.name} â€¢ Adelie Glam`;

        const waMsg = `Hola! Quiero el producto: ${p.name} ($${formatARS(p.price)})\n${location.href}`;
        const waUrl = `https://wa.me/${PHONE}?text=${encodeURIComponent(waMsg)}`;

        box.innerHTML = `
          <article class="product-card" style="grid-column:1/-1; display:grid; grid-template-columns: 1fr 1fr; gap:1rem; align-items:start;">
            <img src="${p.img}" alt="${p.name}" onerror="this.onerror=null;this.src='${PLACEHOLDER_IMG}'" style="width:100%;aspect-ratio:4/3;object-fit:cover;border-radius:12px">
            <div>
              <h1 style="margin:0 0 .4rem">${p.name}</h1>
              <p style="opacity:.7;margin:.25rem 0">${(p.category||'').toUpperCase()}</p>
              <p class="badge" style="display:inline-block;margin:.5rem 0">$${formatARS(p.price)}</p>
              ${p.desc ? `<p style="margin:1rem 0 1.25rem">${p.desc}</p>` : ''}
              <div style="display:flex;gap:.5rem;flex-wrap:wrap">
                <a href="tienda.html" class="btn-mini">Volver a Tienda</a>
                <a href="#" id="add-one" class="btn-mini">Agregar al carrito</a>
                <a href="${waUrl}" class="btn-mini" target="_blank" rel="noopener">Comprar por WhatsApp</a>
              </div>
            </div>
          </article>
        `;

        if (window.matchMedia("(max-width: 720px)").matches) {
          const card = box.querySelector('.product-card');
          card.style.gridTemplateColumns = '1fr';
        }

        document.getElementById('add-one')?.addEventListener('click', (e)=>{
          e.preventDefault();
          window.AdelieCart?.addItem({ slug:p.slug, name:p.name, price:p.price, img:p.img }, 1);
          window.AdelieCart?.openCart();
        });

        // Update badge from localStorage
        if (window.AdelieCart?.readCart) {
          const count = window.AdelieCart.readCart().reduce((s,x)=>s+x.qty,0);
          const badge = document.getElementById('cart-count');
          if (badge) badge.textContent = count;
        }
      } catch (err) {
        console.error(err);
        const box = document.getElementById('product-details');
        if (box) {
          box.innerHTML = `<p style="grid-column:1/-1;text-align:center;color:#b54a64">No pudimos cargar el producto. RevisÃ¡ la consola del navegador para mÃ¡s detalles.</p>`;
        }
      }
    })();
  </script>
  <!-- EmailJS SDK + init -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  emailjs.init('QhF5zexxp_jqNkCUI'); // your PUBLIC key
</script>
</body>
</html>
